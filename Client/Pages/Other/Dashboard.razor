@page "/dashboard"
@using kTVCSSBlazor.Client.Authorization
@inject StateProvider StateProvider
@inject HttpClient http

<PageTitle>kTVCSS @@ Дашборд</PageTitle>

<CascadingAuthenticationState>
    <AuthorizeView>
        <Authorized>
            @if (ready)
            {
                @if (StateProvider.CurrentUser.Role >= kTVCSS.Models.Db.Models.Roles.RoleType.Admin)
                {
                    <RadzenStack Gap="1rem">
                        <RadzenRow JustifyContent="JustifyContent.Center" AlignItems="AlignItems.Center">
                            <RadzenCard>
                                <RadzenStack Orientation="Orientation.Horizontal">
                                    <RadzenLabel class="rz-m-auto" Text="Количество дней" />
                                    <RadzenNumeric @bind-Value=@days />
                                    <RadzenButton Click="Apply" Text="Применить" />
                                </RadzenStack>
                            </RadzenCard>
                        </RadzenRow>
                        @if (data.Any() && data.Count() > 0)
                        {
                            <RadzenTabs>
                                <Tabs>
                                    <RadzenTabsItem Text="Информация за текущий день / всего">
                                        <DashboardCommon Data="data" />
                                    </RadzenTabsItem>
                                    <RadzenTabsItem Text="Графики за период">
                                        <DashboardGraphs Data="data" />
                                    </RadzenTabsItem>
                                    <RadzenTabsItem Text="Информация по активности админов в тикетах">
                                        <DashboardAdminActivity Admins="admins" />
                                    </RadzenTabsItem>
                                    <RadzenTabsItem Text="Логи">
                                        <NLogLogs Logs="logs" />
                                    </RadzenTabsItem>
                                </Tabs>
                            </RadzenTabs>
                        }
                    </RadzenStack>
                }
                else
                {
                    <kTVCSSBlazor.Client.Components.NoAccess />
                }
            }
            else
            {
                <kTVCSSBlazor.Client.Components.ComponentLoader Text="Идет загрузка данных" />
            }
        </Authorized>
        <NotAuthorized>
            <kTVCSSBlazor.Client.Components.NoAccess />
        </NotAuthorized>
    </AuthorizeView>
</CascadingAuthenticationState>
