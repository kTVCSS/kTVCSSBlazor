@page "/createlibraryitem"
@using kTVCSS.Models.Db.Models.Roles
@using kTVCSSBlazor.Client.Authorization
@using kTVCSSBlazor.Client.Components
@using kTVCSSBlazor.Db
@using kTVCSSBlazor.Db.Models.Arcticles
@inject StateProvider AuthProvider
@inject NotificationService notifyService
@inject NavigationManager nm
@inject HttpClient http

@if (ready)
{
    <CascadingAuthenticationState>
        <AuthorizeView>
            <Authorized>
                @if (AuthProvider.CurrentUser.Role >= kTVCSS.Models.Db.Models.Roles.RoleType.Moderator)
                {
                    <RadzenStack>
                        <RadzenText TextStyle="TextStyle.DisplayH4" Text="Создание статьи для базы знаний" />
                        <RadzenFormField Text="Заголовок" Style="width: 100%;">
                            <RadzenTextBox @bind-Value="@article.Title" />
                        </RadzenFormField>
                        <RadzenFormField Text="Права доступа" Style="width: 100%;">
                            <RadzenDropDown Data="@(Enum.GetValues(typeof(RoleType)).Cast<Enum>())" @bind-Value=@article.Role
                                AllowClear="true" AllowFiltering="true"
                                FilterCaseSensitivity="FilterCaseSensitivity.CaseInsensitive">
                            </RadzenDropDown>
                        </RadzenFormField>
                        <RadzenHtmlEditor @bind-Value=@article.Html style="height: 600px;" />
                        <RadzenButton Click="Add" Text="Создать" />
                    </RadzenStack>
                }
                else
                {
                    <NoAccess />
                }
            </Authorized>
            <NotAuthorized>
                <NoAccess />
            </NotAuthorized>
        </AuthorizeView>
    </CascadingAuthenticationState>
}
else
{
    <RadzenRow JustifyContent="JustifyContent.Center">
        <RadzenStack AlignItems="AlignItems.Center" JustifyContent="JustifyContent.Center">
            <Loader Size="ProgressBarCircularSize.Medium" Text="Идет загрузка страницы создания новости" />
        </RadzenStack>
    </RadzenRow>
}
